# Домашнее задание к занятию «Компоненты Kubernetes»

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

Расчёт необходимых ресурсов:

|                     | Ядра CPU | RAM, ГБ | Реплики | Всего ядер | Всего RAM, ГБ |
|---------------------|----------|---------|---------|------------|---------------|
| База данных         | 1        | 4       | 3       | 3          | 12            |
| Система кеширования | 1        | 4       | 3       | 3          | 12            |
| Фронтенд            | 0,2      | 0,05    | 5       | 1          | 0,25          |
| Бекенд              | 1        | 0,6     | 10      | 10         | 6             |
| ИТОГО               |          |         |         | 17         | 30,25         |

Для обеспечения отказоустойчивости рассмотрим конфигурацию кластера 3 Control plane + 3 Worker node.

Для Control plane используем конфигурацию 4 CPU, 4 ГБ RAM.

Рассчитаем рабочую нагрузку на Worker node в случае выхода одной ноды из строя:

CPU = 17 / 2 = 8,5 

RAM = 30,25 ГБ / 2 = 15,12 ГБ

Если для каждой ноды взять конфигурацию 10 СPU и 20 ГБ, то системные резервы составят:

CPU:

- 6% - на первое ядро
- 1% - на второе ядро
- 1% - суммарно на 3-е и 4-е ядро
- 1,5% - суммарно на остальные ядра

Итого: 9,5% = 0,095 CPU 

RAM:

- 25% - на первые 4 ГБ = 4 * 0,25 = 1 ГБ
- 20% - на вторые 4 ГБ = 4 * 0,2 = 0,8 ГБ
- 10% - на следующие 8 ГБ = 8 * 0,1 = 0,8 ГБ
- 6% - на оставшиеся 4 ГБ = 4 * 0,06 = 0,24 ГБ
- Eviction threshold - 0,1 ГБ

Итого: 2,94 ГБ

С учётом системных резервов на рабочую нагрузку будет выделено 9,905 CPU и 17,06 ГБ RAM, что соответствует требованиям проекта.

Таким образом, для реализации проекта потребуется:

- 3 Control plane с конфигурацией 4 CPU, 4 ГБ RAM
- 3 Worker node с конфигурацией 10 CPU, 20 ГБ RAM



